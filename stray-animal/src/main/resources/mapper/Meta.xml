<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.lqa.strayanimal.mapper.MetaMapper">
    <select id="getMetaById" resultMap="com.lqa.strayanimal.entity.Meta">
        select distinct
        m1.id, m1.keep_alive, m1.require_auth
        from menu m1, menu m2, admin_role ar, menu_role, mr
        where m1.id = m2.parent_id
          and m1.id = #{menuId}
          and ar.admin_id = #{adminId}
          and ar.role_id = mr.role_id
          and mr.menuId = m2.id
          and m2.enabled = true
        order by m1.id, m2.id
    </select>

    <select id="getMetasById" resultMap="com.lqa.strayanimal.entity.Meta">
        select distinct
        m2.id, m2.keep_alive, m2.require_auth
        from menu m1, menu m2, admin_role ar, menu_role mr
        where m1.id = m2.parent_id
          and ar.admin_id = #{adminId}
          and ar.role_id = mr.role_id
          and mr.menu_id = m2.id
          and m2.id = #{menuId}
          and m2.enabled = true
        order by m1.id, m2.id
    </select>

</mapper>
